<script>
  import s from '../_utils/plural-s.js';
  import CheckboxChip from './checkbox-chip.svelte';

  let _class = null;
  export { _class as class };
  export let checkboxClass = null;
  export let labelClass = null;

  export let items;
  export let name;
  export let max = null;

  $: currentChecked = items.reduce((acc, elt) => acc + elt.checked, 0);
  const maxReachedTooltip = { title: `Can only select ${max} value${s(max)}.` };

  if (!items || items.length === 0) {
    console.error('Must have at least one item in the checkbox chip group');
  }
</script>

{#if items != null && items.length !== 0}
  <div class={_class} role="group">
    {#each items as item (item.value)}
      <CheckboxChip
        {name}
        value={item.value}
        bind:checked={item.checked}
        disabled={item.disabled || (!item.checked && max != null && currentChecked >= max)}
        class={checkboxClass}
        on:change
        {...$$restProps}
        {...(
          !item.disabled
          && !item.checked
          && max != null
          && currentChecked >= max
          ? maxReachedTooltip : {}
        )}
      >
        {#if labelClass != null}
          <span class={labelClass}>{item.label || item.value}</span>
        {:else}
          {item.label || item.value}
        {/if}
      </CheckboxChip>
    {/each}
  </div>
{/if}

<style src="./chip-group.scss"></style>
